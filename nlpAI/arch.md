# Email AI Classifier Specs

use> python c_nlpAI.py infile [outfile -aiCt]
infile = list of emails
outfile = file to put results may have same name as infile  - no output if omitted
-aiCt = how many emails to use starting with first - use whole infile if omitted or larger than infile count

The architecture follows the MVC construction.

#View
v_nlpAI.py is the view. It is divided into three frames.

##Email Frame
The program will start up pointing to the first email from infile

mailId in the upper left is the email's unique id in the pdfs that created infile. it is read-only

The main frame is the read-only contents of the email

##Control Frame
This frame is along the bottom of the program

Goto is a text input box for typing in a mailID. Hit return and the Email Frame will display the email

Hypo is just a convenient place to write the hypothesis being tested. It is not used anywhere

ai is the hypo generated by the classifier for the current email. It can only be edited in Search Mode
  * None - classifier has not been run
  * True
  * False

tr is the hypo created by human training. It can only be edited in Train mode
  * None - not trained
  * True
  * False

Clicking ai or tr toggles between True and False when edit is enabled

Next fetches the next email as a function of ai and mode

Prev fetches the previous email as a function of ai and mode

Mode is the rightmost button and clicking it rotates among the modes shown below

mode | ai edit | tr edit | next | prev
-----|---------|---------|------|-----
read | no | no | next | previous
search | yes | no | next ai match | previous ai match
train | no | yes | random untrained | nop

The ai Hypo can only be changed by running the classifier again. The training hypo can be changed by putting the current email in train mode and toggling tr.

##AI Frame
This is along the left side of the email frame and provides control and stats for the classifier

runAI trains the classifier using the trHypo setting for all the trained emails, runs the classifier on all the emails and calculates stats.

aiAlg selects on of three classifier algorithms
  * nvb - naive Bayes
  * svm - support vector machine
  * rfa - rain forest algorithm

ai result - calculated read only stat
  * pass - the precentage of true hypos found by AI are within the error margin of the trained true hypos
  * fail - the precentage of true hypos found by AI are outside the error margin of the trained true hypos

confidence % - how confident we want to be in the ai result. Setting it to a lower number will lower the number of emails that must be trained.

train size - read-only stat showing how many emails must be trained to acheive the selected confidence

trained - read-only count of number of emails trained

train true % - percentage of trained emails that are true 

ai size - read-only stat of number of emails included in ai clasification

ai true % - percentage of ai emails that are true 

##callbacks
These user inputs cause view changes but no model actions so their callbacks are in the view

###mode
  rotate among read, search and train

###aiHypo
  if mode = search toggle between true and false

###aiAlg
  rotate among nvb, svm and rfa

#Model
m_nlpAI.py contains the model that is loaded with the emails from infile

##initialization
* Load mails from infile.json
* get ai size from input argument of lengtth of mails
* get train sz and train true from train field of each email in ai size
* set email pointer to first email

## email database structure
 
json structure of email database
[                     #email list containing email records of the following form
  {mailNo : integer,  #sequential from 0 thru all 10k+ emails, good for debugging
  train: string,      #human analysis of hypothosis True/False [absent before ai is run]
  ai: string,         #ai analysis of hypothosis True/False [absent before training]
  mailId : string,    #file_page_no - for easily locating an email in pds
  from : string,      #exactly as it appears in pdf. There's lots a variation
  to: string,         # "
  date: string,       # "
  cc : string,        # "
  attach : string,    # "
  subject : string,   # "
  body : string},     #all remaining text in the email, preserving text order
  .                   #another email record just like the one above
  .
  {}                  #last email record
]

#Controller
c_nlpAI.py contains the controller

##initialization
* instantiate model with infile.json and option aiCt
* instantiate view with the following defaults
  * default read mode
  * all data from first email including aiHypo and trHypo
  * aiCt, trCt, aiTrue, trTrue from model  
  * default 50% confidence
  * calculated train size

##Callbacks from view changes
These view changes cause controller or model actions so their callbacks are in the controller

###runAI
  * get classifier select from view
  * run the selected ai classifier
  * calculate the ai result and display
  * calculate the ai true and display

###Confidence %
  * calculate train size and display

###Goto
  * get the mailId from entry box
  * point model to this mail
  * get from the model email, aiHYpo and trHypo
  * send them to the view

###trHypo
get mode from view and if mode = train
* set train in the current model email
* change trHypo in view
* change stats in view
else ignore the callback

###next
* get mode from view
* train mode - get and display random untrained email
* read mode  - get and display next email
* search mode 
  * get aiHypo from view
  * get next email that matched aiHypo

###prev
* get mode from view
* train mode - ignore
* read mode  - get and display previous email
* search mode 
  * get aiHypo from view
  * get previous email that matched aiHypo

